
<!DOCTYPE html>
<html style="margin: 0px; width: 100%; height: 100%;">
<head>
  <title>NÃ¤ssy Plotter</title>
  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script><% include ../js/mapbox-gl.js %></script>

  <!-- Favicons start -->

  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/manifest.json">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <!-- Favicons end -->


  <link href='stylesheets/mapbox-gl.css' rel='stylesheet' />
</head>
<body style="margin: 0px; width: 100%; height: 100%;">
  <div id="map" style="margin: 0px; width: 100%; height: 100%;"></div>

  <script>
  mapboxgl.accessToken = 'pk.eyJ1IjoibWlsa2FuZGNyZWFtIiwiYSI6ImNpb3dxcHZzazAwOWJ3OWtqNHNjdTgzNjMifQ.KK7QXbd-tSQzfH96p9rpPg';
    var map = new mapboxgl.Map({
        attributionControl : false,
        container: 'map',
        style: 'mapbox://styles/milkandcream/ciowqs054000uqmmald86hbka'
    });

    var pos = []

    var source = new mapboxgl.GeoJSONSource({
      data: {"geometry": {"type": "Point", "coordinates": [23.783832999999998, 61.503015399999995]}, "type": "Feature", "properties": {}}
    });

    // Try HTML5 geolocation.
    if (navigator.geolocation) {
      window.setInterval(function() {
          console.log( "update location" )

          navigator.geolocation.getCurrentPosition(function(position) {
            pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            console.log(pos)

            source.setData({"geometry": {"type": "Point", "coordinates": pos}, "type": "Feature", "properties": {}})

          }, function() {
            handleLocationError(true);
          },
          {
            enableHighAccuracy: true
          });
      }, 10000);

    } else {
      // Browser doesn't support Geolocation
      handleLocationError(false);
  }
  

  function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    console.log(browserHasGeolocation ?
                          'Error: The Geolocation service failed.' :
                          'Error: Your browser doesn\'t support geolocation.');
  }

  map.addControl(new mapboxgl.Navigation({position: 'bottom-right'}));
  map.addControl(new mapboxgl.Geolocate({position: 'top-left'}));

  map.on('load', function () {
      map.addSource('drone', source);
      map.addLayer({
          "id": "drone",
          "type": "symbol",
          "source": "drone",
          "layout": {
              "icon-image": "ferry-15",
          }
      });
  });

  </script>
</body>
</html>
